<!DOCTYPE HTML>

<html>
<title>SSVEP Stimulator</title>

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- <script src="dist/index.js"></script> -->
  <link rel="stylesheet" type="text/css" href="./bootstrap.css" />
  <link rel="stylesheet" type="text/css" href="./style.css" />
</head>

<body>

  <div id="options">
    <h4>SSVEP Options</h4>
    <button id="css_periodic">CSS Periodic</button>
    <button id="css_approximation">CSS Approximation</button>
    <button id="webgl_periodic">WebGL Periodic</button>
    <button id="webgl_approximation">WebGL Approximation</button>
    <button id="cancel">Cancel</button>

  </div>
  <canvas id="drawing_canvas"></canvas>

  <div id="content">
    <div id="buttonDiv" class="container-fluid">
      <div class="row my-lg-4 my-sm-0 mx-lg-1 mx-sm-0">
        <div class="col-3 mr-lg-4 mr-sm-0">
          <div id="stim_1" class="SSVEP">A B C</br>D E F</br>G H I</div>
        </div>

        <div class="col-3 mr-lg-4 mr-sm-0">
          <div id="stim_2" class="SSVEP">J K L</br>M N O</br>P Q R</div>
        </div>

        <div class="col-3 mr-lg-4 mr-sm-0">
          <div class="SSVEP">S T U</br>V W X</br>Y Z _</div>
        </div>
      </div>

      <div class="row my-lg-3 my-sm-0 mx-lg-1 mx-sm-0">
        <div class="col-9 my-auto">
          <form name="submitForm">
            <input type="text" class="sentenceArea" id="txtToType" value="HELLO" readonly>
            <input type="text" id="txtOutput" readonly>
          </form>
        </div>

        <!--data-phase-shift should be defined in terms of pi-->
        <div class="col-3 text-right">
          <div class="SSVEP">Delete</div>
        </div>
      </div>


      <div class="row my-lg-4 my-sm-0 mx-lg-1 mx-sm-0">
        <div class="col-3 mr-lg-4 mr-sm-0">
          <div class="SSVEP">Word1</div>
        </div>

        <div class="col-3 mr-lg-4 mr-sm-0">
          <div class="SSVEP">Word2</div>
        </div>

        <div class="col-3 mr-lg-4 mr-sm-0">
          <div class="SSVEP">Word3</div>
        </div>
      </div>
    </div>
  </div>

</body>

<script type="module">

  import * as stimuli from "./src/index.js"

  // import * as stimuli from "./dist/index.esm.js"

  // ------------------------ Arbitrary Elements ------------------------
  const buttons = document.getElementById('options').querySelectorAll('button')
  const elements = document.body.querySelectorAll('.SSVEP')
  const canvas = document.body.querySelector('canvas')

  // ------------------------ Attributes ------------------------
  const attributes = [
    { frequency: 6.67, "dark-color": "0, 0, 0, 1", "light-color": "1, 0, 0, 1", "phase-shift": "0" },
    { frequency: 20, "dark-color": "0, 0, 0, 1", "light-color": "1, 1, 1, 1", "phase-shift": "0" },
    { frequency: 8.57, "dark-color": "0, 0, 0, 1", "light-color": "1, 1, 1, 1", "phase-shift": "0" },
    { frequency: 6.67, "dark-color": "0, 0, 0, 1", "light-color": "1, 1, 1, 1", "phase-shift": "0" },
    { frequency: 12, "dark-color": "0, 0, 0, 1", "light-color": "1, 1, 1, 1", "phase-shift": "0" },
    { frequency: 15, "dark-color": "0, 0, 0, 1", "light-color": "1, 1, 1, 1", "phase-shift": "0" },
    { frequency: 6.67, "dark-color": "0, 0, 0, 1", "light-color": "1, 1, 1, 1", "phase-shift": "0" },
  ]


  const css = new stimuli.CSS('periodic', 10)
  elements.forEach(el => css.set(el))


  // ------------------------ Setup Options ------------------------
  let cancel = null

  buttons.forEach(el => {
    const [type, method] = el.id.split('_')

    // Set OnClick Event
    el.onclick = async () => {

      // Set Method on Classes
      css.method = method

      if (cancel instanceof Function) cancel() // Cancel ongoing stimuli generation

      if (el.id != 'cancel') {
        const arr = Array.from(elements)

        // Step 1: Apply Frequencies to Elements
        arr.forEach((element, i) => {
          for (let key in attributes[i]) element.setAttribute(`data-${key}`, attributes[i][key])
        })

        // Step 2: Animate
        const thisType = stimuli[type]
        if (thisType) {
          if (type === 'webgl') cancel = await thisType.start(method, elements, canvas)
          else {
            await css.start()
            cancel = css.stop
            // cancel = await thisType.start(method, elements)
          }
          // else cancel = await thisType.start(method, elements)

        }
        else console.error('This type/method pair does not exist')
      }
    }
  })

</script>

</html>